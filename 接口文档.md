# 用户模块接口文档 (User API)

## 基础路径
所有用户相关接口都以 `/api/v1/users` 为基础路径

## 接口列表

### 1. 用户注册
- **接口地址**: `POST /api/v1/users/register`
- **功能说明**: 新用户注册
- **请求体**:
  ```json
  {
    "phone": string,      // 必填，手机号，用于登录
    "password": string,   // 必填，密码，最小6位
    "name": string,       // 必填，用户姓名
    "address": string,    // 选填，用户地址
    "age": int,          // 必填，用户年龄
    "role": string,      // 选填，用户角色：task_publisher-发布任务者, pet_sitter-宠物照看者
    "description": string, // 选填，用户描述
    "rating": float      // 选填，用户评分，默认5.0
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": {
      "id": int,
      "name": string,
      "phone": string,
      "address": string,
      "age": int,
      "role": string,
      "description": string,
      "rating": float,
      "completed_tasks": int,
      "status": string,
      "created_at": string,
      "updated_at": string
    },
    "message": "success"
  }
  ```
- **错误响应**:
  ```json
  {
    "code": 400,
    "data": null,
    "message": "手机号已存在"
  }
  ```

### 2. 用户登录
- **接口地址**: `POST /api/v1/users/login`
- **功能说明**: 用户登录，获取登录凭证
- **请求体**:
  ```json
  {
    "phone": string,    // 必填，手机号
    "password": string  // 必填，密码
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": {
      "user": {
        "id": int,
        "name": string,
        "phone": string,
        // ... 其他用户信息
      }
    },
    "message": "success"
  }
  ```
- **错误响应**:
  ```json
  {
    "code": 400,
    "data": null,
    "message": "invalid phone or password"
  }
  ```

### 3. 修改密码
- **接口地址**: `POST /api/v1/users/:id/password`
- **功能说明**: 修改用户密码
- **路径参数**:
    - id: 用户ID
- **请求体**:
  ```json
  {
    "old_password": string,  // 必填，原密码
    "new_password": string   // 必填，新密码，最小6位
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": null,
    "message": "password changed successfully"
  }
  ```

### 4. 更新用户状态
- **接口地址**: `PUT /api/v1/users/:id/status`
- **功能说明**: 更新用户状态（管理员功能）
- **路径参数**:
    - id: 用户ID
- **请求体**:
  ```json
  {
    "status": string  // 必填，状态：active-正常, disabled-禁用, locked-锁定
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": null,
    "message": "status updated successfully"
  }
  ```

### 5. 更新用户信息
- **接口地址**: `PUT /api/v1/users/:id`
- **功能说明**: 更新用户基本信息
- **路径参数**:
    - id: 用户ID
- **请求体**:
  ```json
  {
    "name": string,       // 选填，用户姓名
    "address": string,    // 选填，地址
    "phone": string,      // 选填，手机号
    "age": int,          // 选填，年龄
    "role": string,      // 选填，角色
    "description": string, // 选填，描述
    "rating": float      // 选填，评分
  }
  ```
- **成功响应**: 返回更新后的用户信息

### 6. 获取用户信息
- **接口地址**: `GET /api/v1/users/:id`
- **功能说明**: 获取指定用户的详细信息
- **路径参数**:
    - id: 用户ID
- **成功响应**: 返回用户完整信息

### 7. 删除用户
- **接口地址**: `DELETE /api/v1/users/:id`
- **功能说明**: 删除用户（软删除）
- **路径参数**:
    - id: 用户ID
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": null,
    "message": "user deleted successfully"
  }
  ```

### 8. 用户列表
- **接口地址**: `GET /api/v1/users`
- **功能说明**: 获取用户列表，支持分页
- **查询参数**:
    - page: int, 页码，默认1
    - page_size: int, 每页数量，默认10
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": {
      "items": [
        {
          "id": int,
          "name": string,
          // ... 其他用户信息
        }
      ],
      "total": int,
      "page": int,
      "page_size": int
    },
    "message": "success"
  }
  ```

### 9. 通过手机号查询用户
- **接口地址**: `GET /api/v1/users/phone/:phone`
- **功能说明**: 根据手机号查询用户信息
- **路径参数**:
    - phone: 手机号
- **成功响应**: 返回用户信息
- **错误响应**:
  ```json
  {
    "code": 400,
    "data": null,
    "message": "user not found"
  }
  ```

### 权限要求
- 注册/登录接口：无需权限
- 用户信息相关接口：需要用户登录
- 修改密码：需要用户本人
- 更新状态：需要管理员权限

# 任务模块接口文档 (Task API)

## 基础路径
所有任务相关接口都以 `/api/v1/tasks` 为基础路径

## 接口列表

### 1. 创建任务
- **接口地址**: `POST /api/v1/tasks`
- **功能说明**: 发布新的宠物照护任务
- **请求体**:
  ```json
  {
    "publisher_id": int,     // 必填，发布者ID
    "pet_id": int,          // 必填，宠物ID
    "title": string,        // 必填，任务标题
    "description": string,  // 必填，任务描述
    "reward": float,       // 必填，任务报酬
    "start_time": string,  // 必填，开始时间，格式：2006-01-02T15:04:05Z
    "end_time": string,    // 必填，结束时间，格式：2006-01-02T15:04:05Z
    "location": string,    // 必填，任务地点
    "requirements": string, // 选填，特殊要求
    "visits_count": int,    // 必填，每天探访次数
    "care_instructions": string // 必填，照护说明
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": {
      "id": int,
      "publisher_id": int,
      "pet_id": int,
      "sitter_id": int,
      "title": string,
      "description": string,
      "reward": float,
      "start_time": string,
      "end_time": string,
      "location": string,
      "requirements": string,
      "visits_count": int,
      "care_instructions": string,
      "status": string,
      "created_at": string,
      "updated_at": string
    },
    "message": "success"
  }
  ```

### 2. 更新任务
- **接口地址**: `PUT /api/v1/tasks/:id`
- **功能说明**: 更新任务信息
- **路径参数**:
    - id: 任务ID
- **请求体**: 同创建任务，所有字段都是选填
- **权限要求**: 只有发布者可以更新
- **成功响应**: 返回更新后的任务信息

### 3. 获取任务详情
- **接口地址**: `GET /api/v1/tasks/:id`
- **功能说明**: 获取任务详细信息
- **路径参数**:
    - id: 任务ID
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": {
      "id": int,
      "publisher_id": int,
      "publisher": {
        "id": int,
        "name": string,
        // ... 发布者信息
      },
      "pet": {
        "id": int,
        "name": string,
        // ... 宠物信息
      },
      // ... 其他任务信息
    },
    "message": "success"
  }
  ```

### 4. 删除任务
- **接口地址**: `DELETE /api/v1/tasks/:id`
- **功能说明**: 删除任务
- **路径参数**:
    - id: 任务ID
- **权限要求**: 只有发布者可以删除
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": null,
    "message": "success"
  }
  ```

### 5. 任务列表
- **接口地址**: `GET /api/v1/tasks`
- **功能说明**: 获取任务列表，支持分页和筛选
- **查询参数**:
    - page: int, 页码，默认1
    - page_size: int, 每页数量，默认10
    - status: string, 任务状态筛选
    - start_time: string, 开始时间筛选
    - end_time: string, 结束时间筛选
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": {
      "items": [
        {
          "id": int,
          "title": string,
          // ... 任务基本信息
        }
      ],
      "total": int,
      "page": int,
      "page_size": int
    },
    "message": "success"
  }
  ```

### 6. 获取用户发布的任务
- **接口地址**: `GET /api/v1/tasks/publisher/:id`
- **功能说明**: 获取指定用户发布的所有任务
- **路径参数**:
    - id: 发布者ID
- **成功响应**: 返回任务列表

### 7. 获取照看者接受的任务
- **接口地址**: `GET /api/v1/tasks/sitter/:id`
- **功能说明**: 获取指定照看者接受的所有任务
- **路径参数**:
    - id: 照看者ID
- **成功响应**: 返回任务列表

### 8. 获取宠物的任务
- **接口地址**: `GET /api/v1/tasks/pet/:id`
- **功能说明**: 获取指定宠物相关的所有任务
- **路径参数**:
    - id: 宠物ID
- **成功响应**: 返回任务列表

### 9. 更新任务状态
- **接口地址**: `PUT /api/v1/tasks/:id/status`
- **功能说明**: 更新任务状态
- **路径参数**:
    - id: 任务ID
- **请求体**:
  ```json
  {
    "status": string  // 必填，任务状态：pending-待接单, accepted-已接单, in_progress-进行中, completed-已完成, cancelled-已取消
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": null,
    "message": "success"
  }
  ```

### 任务状态流转
1. pending -> accepted: 照看者接单
2. accepted -> in_progress: 到达开始时间
3. in_progress -> completed: 任务完成
4. pending/accepted -> cancelled: 发布者取消任务

### 权限说明
- 创建任务：需要用户登录且角色为task_publisher
- 更新任务：仅任务发布者
- 接受任务：需要用户登录且角色为pet_sitter
- 查看任务：所有已登录用户
- 更新状态：根据状态不同有不同权限要求


# 地址模块接口文档 (Address API)

## 基础路径
所有地址相关接口都以 `/api/v1/addresses` 为基础路径

## 接口列表

### 1. 创建地址
- **接口地址**: `POST /api/v1/addresses`
- **功能说明**: 为用户创建新的地址信息
- **请求体**:
  ```json
  {
    "user_id": int,           // 必填，用户ID
    "name": string,           // 必填，地址名称，如"家"、"公司"
    "province": string,       // 必填，省份
    "city": string,          // 必填，城市
    "district": string,      // 必填，区域
    "street": string,        // 必填，街道
    "detailed_info": string, // 必填，详细地址信息
    "contact_name": string,  // 必填，联系人姓名
    "contact_phone": string, // 必填，联系电话
    "is_default": bool      // 选填，是否设为默认地址，默认false
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": {
      "id": int,
      "user_id": int,
      "name": string,
      "province": string,
      "city": string,
      "district": string,
      "street": string,
      "detailed_info": string,
      "contact_name": string,
      "contact_phone": string,
      "is_default": bool,
      "created_at": string,
      "updated_at": string
    },
    "message": "success"
  }
  ```

### 2. 更新地址
- **接口地址**: `PUT /api/v1/addresses/:id`
- **功能说明**: 更新指定地址的信息
- **路径参数**:
    - id: 地址ID
- **请求体**: 同创建地址，所有字段都是选填
- **权限要求**: 只有地址所属用户可以更新
- **成功响应**: 返回更新后的地址信息

### 3. 获取地址详情
- **接口地址**: `GET /api/v1/addresses/:id`
- **功能说明**: 获取指定地址的详细信息
- **路径参数**:
    - id: 地址ID
- **成功响应**: 返回地址完整信息
- **错误响应**:
  ```json
  {
    "code": 404,
    "data": null,
    "message": "address not found"
  }
  ```

### 4. 删除地址
- **接口地址**: `DELETE /api/v1/addresses/:id`
- **功能说明**: 删除指定地址
- **路径参数**:
    - id: 地址ID
- **权限要求**: 只有地址所属用户可以删除
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": null,
    "message": "success"
  }
  ```

### 5. 地址列表
- **接口地址**: `GET /api/v1/addresses`
- **功能说明**: 获取地址列表，支持分页
- **查询参数**:
    - page: int, 页码，默认1
    - page_size: int, 每页数量，默认10
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": {
      "items": [
        {
          "id": int,
          "name": string,
          // ... 地址信息
        }
      ],
      "total": int,
      "page": int,
      "page_size": int
    },
    "message": "success"
  }
  ```

### 6. 获取用户的地址列表
- **接口地址**: `GET /api/v1/addresses/user/:user_id`
- **功能说明**: 获取指定用户的所有地址
- **路径参数**:
    - user_id: 用户ID
- **权限要求**: 只能查看自己的地址列表
- **成功响应**: 返回地址列表

### 7. 获取用户的默认地址
- **接口地址**: `GET /api/v1/addresses/default/:user_id`
- **功能说明**: 获取指定用户的默认地址
- **路径参数**:
    - user_id: 用户ID
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": {
      "id": int,
      "name": string,
      // ... 默认地址信息
    },
    "message": "success"
  }
  ```

### 8. 设置默认地址
- **接口地址**: `PUT /api/v1/addresses/:id/default/:user_id`
- **功能说明**: 将指定地址设置为用户的默认地址
- **路径参数**:
    - id: 地址ID
    - user_id: 用户ID
- **权限要求**: 只能设置自己的默认地址
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": null,
    "message": "success"
  }
  ```

## 通用说明

### 权限要求
- 创建地址：需要用户登录
- 更新地址：需要是地址所属用户
- 删除地址：需要是地址所属用户
- 查看地址：需要是地址所属用户
- 设置默认地址：需要是地址所属用户

### 业务规则
1. 每个用户可以有多个地址
2. 每个用户只能有一个默认地址
3. 设置新的默认地址时，原默认地址会自动取消默认状态
4. 删除默认地址时，用户将没有默认地址
5. 创建第一个地址时，自动设为默认地址

# 社区模块接口文档 (Community API)

## 基础路径
所有社区相关接口都以 `/api/v1/communities` 为基础路径

## 接口列表

### 1. 创建帖子
- **接口地址**: `POST /api/v1/communities`
- **功能说明**: 发布新的社区帖子
- **请求体**:
  ```json
  {
    "author_id": int,     // 必填，作者ID
    "pet_id": int,        // 必填，相关宠物ID
    "title": string,      // 必填，帖子标题
    "type": string,       // 必填，帖子类型：experience-经验分享, question-问题咨询, show-宠物展示
    "content": string,    // 必填，帖子内容
    "images": [string],   // 选填，图片URL数组
    "tags": [string],     // 选填，标签数组
    "is_pinned": bool     // 选填，是否置顶，默认false
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": {
      "id": int,
      "author": {
        "id": int,
        "name": string,
        // ... 作者基本信息
      },
      "pet": {
        "id": int,
        "name": string,
        // ... 宠物基本信息
      },
      "title": string,
      "type": string,
      "content": string,
      "images": [string],
      "tags": [string],
      "is_pinned": bool,
      "likes_count": int,
      "views_count": int,
      "created_at": string,
      "updated_at": string
    },
    "message": "success"
  }
  ```

### 2. 更新帖子
- **接口地址**: `PUT /api/v1/communities/:id`
- **功能说明**: 更新帖子内容
- **路径参数**:
    - id: 帖子ID
- **请求体**: 同创建帖子，所有字段都是选填
- **权限要求**: 只有作者可以更新
- **成功响应**: 返回更新后的帖子信息

### 3. 获取帖子详情
- **接口地址**: `GET /api/v1/communities/:id`
- **功能说明**: 获取帖子详细信息，同时增加浏览量
- **路径参数**:
    - id: 帖子ID
- **成功响应**: 返回帖子完整信息，包括作者和宠物信息

### 4. 删除帖子
- **接口地址**: `DELETE /api/v1/communities/:id`
- **功能说明**: 删除帖子
- **路径参数**:
    - id: 帖子ID
- **权限要求**: 作者或管理员可以删除
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": null,
    "message": "success"
  }
  ```

### 5. 帖子列表
- **接口地址**: `GET /api/v1/communities`
- **功能说明**: 获取帖子列表，支持分页和筛选
- **查询参数**:
    - page: int, 页码，默认1
    - page_size: int, 每页数量，默认10
    - type: string, 帖子类型筛选
    - tag: string, 标签筛选
    - sort: string, 排序方式：latest-最新, popular-最热
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": {
      "items": [
        {
          "id": int,
          "title": string,
          "author": {
            "id": int,
            "name": string
          },
          "type": string,
          "likes_count": int,
          "views_count": int,
          "created_at": string
        }
      ],
      "total": int,
      "page": int,
      "page_size": int
    },
    "message": "success"
  }
  ```

### 6. 获取用户的帖子列表
- **接口地址**: `GET /api/v1/communities/author/:id`
- **功能说明**: 获取指定用户发布的所有帖子
- **路径参数**:
    - id: 作者ID
- **成功响应**: 返回帖子列表

### 7. 获取宠物相关帖子
- **接口地址**: `GET /api/v1/communities/pet/:id`
- **功能说明**: 获取与指定宠物相关的所有帖子
- **路径参数**:
    - id: 宠物ID
- **成功响应**: 返回帖子列表

### 8. 获取指定类型的帖子
- **接口地址**: `GET /api/v1/communities/type/:type`
- **功能说明**: 获取指定类型的帖子列表
- **路径参数**:
    - type: 帖子类型
- **查询参数**:
    - page: int
    - page_size: int
- **成功响应**: 返回帖子列表

### 9. 更新点赞数
- **接口地址**: `PUT /api/v1/communities/:id/likes`
- **功能说明**: 更新帖子点赞数
- **路径参数**:
    - id: 帖子ID
- **请求体**:
  ```json
  {
    "increment": bool  // true-点赞，false-取消点赞
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": {
      "likes_count": int  // 更新后的点赞数
    },
    "message": "success"
  }
  ```

### 10. 更新浏览量
- **接口地址**: `PUT /api/v1/communities/:id/views`
- **功能说明**: 更新帖子浏览量（自动累加）
- **路径参数**:
    - id: 帖子ID
- **成功响应**: 返回更新后的浏览量

## 通用说明

### 帖子类型说明
- experience: 经验分享
- question: 问题咨询
- show: 宠物展示

### 权限要求
- 创建帖子：需要用户登录
- 更新帖子：仅作者可更新
- 删除帖子：作者或管理员
- 查看帖子：所有用户
- 点赞操作：需要用户登录

### 业务规则
1. 帖子创建后浏览量初始为0
2. 同一用户对同一帖子只能点赞一次
3. 帖子可以被管理员置顶
4. 图片上传需要先调用专门的上传接口获取URL
5. 删除帖子会同时删除相关的评论

# 宠物照护申请模块接口文档 (SitterApplication API)

## 基础路径
所有照护申请相关接口都以 `/api/v1/sitter-applications` 为基础路径

## 接口列表

### 1. 创建照护申请
- **接口地址**: `POST /api/v1/sitter-applications`
- **功能说明**: 宠物照护者提交照护申请
- **请求体**:
  ```json
  {
    "sitter_id": int,         // 必填，照护者ID
    "owner_id": int,          // 必填，宠物主人ID
    "pet_id": int,            // 必填，宠物ID
    "introduction": string,   // 必填，自我介绍
    "experience": string,     // 必填，相关经验
    "availability": string,   // 必填，可工作时间
    "expected_salary": float  // 必填，期望薪资
  }
  ```
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": {
      "id": int,
      "sitter": {
        "id": int,
        "name": string,
        "rating": float,
        // ... 照护者基本信息
      },
      "owner": {
        "id": int,
        "name": string
        // ... 宠物主人基本信息
      },
      "pet": {
        "id": int,
        "name": string
        // ... 宠物基本信息
      },
      "status": "pending",
      "introduction": string,
      "experience": string,
      "availability": string,
      "expected_salary": float,
      "created_at": string,
      "updated_at": string
    },
    "message": "success"
  }
  ```

### 2. 更新照护申请
- **接口地址**: `PUT /api/v1/sitter-applications/:id`
- **功能说明**: 更新申请信息（仅在待处理状态可更新）
- **路径参数**:
    - id: 申请ID
- **请求体**:
  ```json
  {
    "introduction": string,    // 选填，自我介绍
    "experience": string,      // 选填，相关经验
    "availability": string,    // 选填，可工作时间
    "expected_salary": float   // 选填，期望薪资
  }
  ```
- **权限要求**: 只有申请人可以更新
- **成功响应**: 返回更新后的申请信息

### 3. 获取申请详情
- **接口地址**: `GET /api/v1/sitter-applications/:id`
- **功能说明**: 获取申请详细信息
- **路径参数**:
    - id: 申请ID
- **成功响应**: 返回申请完整信息，包括照护者、宠物主人和宠物信息

### 4. 删除申请
- **接口地址**: `DELETE /api/v1/sitter-applications/:id`
- **功能说明**: 删除照护申请
- **路径参数**:
    - id: 申请ID
- **权限要求**: 申请人或宠物主人可以删除
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": null,
    "message": "success"
  }
  ```

### 5. 申请列表
- **接口地址**: `GET /api/v1/sitter-applications`
- **功能说明**: 获取申请列表，支持分页和筛选
- **查询参数**:
    - page: int, 页码，默认1
    - page_size: int, 每页数量，默认10
    - status: string, 申请状态筛选
    - sort: string, 排序方式：latest-最新, salary-薪资
- **成功响应**: 返回申请列表

### 6. 获取照护者的申请列表
- **接口地址**: `GET /api/v1/sitter-applications/sitter/:id`
- **功能说明**: 获取指定照护者提交的所有申请
- **路径参数**:
    - id: 照护者ID
- **权限要求**: 只能查看自己的申请
- **成功响应**: 返回申请列表

### 7. 获取宠物主人收到的申请列表
- **接口地址**: `GET /api/v1/sitter-applications/owner/:id`
- **功能说明**: 获取指定宠物主人收到的所有申请
- **路径参数**:
    - id: 宠物主人ID
- **权限要求**: 只能查看自己收到的申请
- **成功响应**: 返回申请列表

### 8. 获取宠物的申请列表
- **接口地址**: `GET /api/v1/sitter-applications/pet/:id`
- **功能说明**: 获取指定宠物收到的所有申请
- **路径参数**:
    - id: 宠物ID
- **权限要求**: 宠物主人可查看
- **成功响应**: 返回申请列表

### 9. 获取指定状态的申请列表
- **接口地址**: `GET /api/v1/sitter-applications/status/:status`
- **功能说明**: 获取特定状态的申请列表
- **路径参数**:
    - status: 申请状态
- **查询参数**:
    - page: int
    - page_size: int
- **成功响应**: 返回申请列表

### 10. 更新申请状态
- **接口地址**: `PUT /api/v1/sitter-applications/:id/status`
- **功能说明**: 更新申请状态（主要用于宠物主人处理申请）
- **路径参数**:
    - id: 申请ID
- **请求体**:
  ```json
  {
    "status": string,         // 必填，新状态：accepted/rejected
    "reject_reason": string   // 当status为rejected时必填，拒绝原因
  }
  ```
- **权限要求**: 只有宠物主人可以更新状态
- **成功响应**:
  ```json
  {
    "code": 200,
    "data": null,
    "message": "success"
  }
  ```

## 通用说明

### 申请状态说明
- pending: 待处理
- accepted: 已接受
- rejected: 已拒绝
- cancelled: 已取消
- completed: 已完成

### 权限要求
- 创建申请：需要用户登录且角色为pet_sitter
- 更新申请：仅申请人可更新
- 处理申请：仅宠物主人可处理
- 查看申请：相关方（申请人、宠物主人）可查看

### 业务规则
1. 同一照护者对同一宠物只能有一个进行中的申请
2. 申请被接受后会自动创建相应的任务
3. 申请状态更新后会通知相关方
4. 已处理的申请不能再更新内容
5. 照护者评分会影响申请的展示顺序

